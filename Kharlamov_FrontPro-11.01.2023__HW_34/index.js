
const products = [
    {
        category: 'Телевізори',
        idCategory: 'cat1',
        list: [
            {
                productName: 'LG V42b',
                idProduct: '1',
                img: 'img/5132741.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '1 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`,
                }

            },
            {
                productName: 'Sony L42b',
                idProduct: '2',
                img: 'img/5132741.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '2 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Sony 4K TRE82',
                idProduct: '3',
                img: 'img/5132741.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '3 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'LG Turbo W42b7',
                idProduct: '4',
                img: 'img/5132741.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '4 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Samsung BR56_d43',
                idProduct: '5',
                img: 'img/5132741.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '5 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
        ]
    },
    {
        category: 'Ноутбуки',
        idCategory: 'cat2',
        list: [
            {
                productName: 'Lenovo IdeaPad 1',
                idProduct: '6',
                img: 'img/33824691.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '6 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Asus ROG Strix',
                idProduct: '7',
                img: 'img/33824691.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '7 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'MacBook Air M1',
                idProduct: '8',
                img: 'img/33824691.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '8 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Asus Tyrbo 34g5',
                idProduct: '9',
                img: 'img/33824691.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '10 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'MacBook M3',
                idProduct: '10',
                img: 'img/33824691.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '10 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
        ]
    },
    {
        category: 'Смартфони',
        idCategory: 'cat3',
        list: [
            {
                productName: 'Samsung Galaxy A73',
                idProduct: '11',
                img: 'img/7683132.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '11 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Realme 10 Pro',
                idProduct: '12',
                img: 'img/7683132.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '12 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Apple iPhone 13',
                idProduct: '13',
                img: 'img/7683132.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '13 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Galaxy A5',
                idProduct: '14',
                img: 'img/7683132.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '14 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Realme 3 Gold',
                idProduct: '15',
                img: 'img/7683132.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '15 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
        ]
    },
    {
        category: 'Ігрові приставки',
        idCategory: 'cat4',
        list: [
            {
                productName: 'Xbox Series Х',
                idProduct: '16',
                img: 'img/4704504.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '16 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'PlayStation 5',
                idProduct: '17',
                img: 'img/4704504.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '17 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Nintendo Switch',
                idProduct: '18',
                img: 'img/4704504.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '18 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Xbox S',
                idProduct: '19',
                img: 'img/4704504.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '19 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'PlayStation 3',
                idProduct: '20',
                img: 'img/4704504.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '20 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
        ]
    },
    {
        category: 'Смарт-годинники',
        idCategory: 'cat5',
        list: [
            {
                productName: 'Apple Watch ULTRA',
                idProduct: '21',
                img: 'img/3879794.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '21 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Samsung Galaxy Watch4',
                idProduct: '22',
                img: 'img/3879794.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '22 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Xiaomi Mi Smart Band 6',
                idProduct: '23',
                img: 'img/3879794.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '23 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Apple Watch 2',
                idProduct: '24',
                img: 'img/3879794.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '24 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
            {
                productName: 'Xiaomi clock 2',
                idProduct: '25',
                img: 'img/3879794.png',
                price: '100',
                specification: {
                    year: '2022',
                    color: 'Black',
                    guarantee: '25 года',
                    set: `Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, 
                    when an unknown printer took a galley of type and scrambled it to make a type 
                    specimen book.`
                }
            },
        ]
    },
    ];

const categoryBlock = document.querySelector('.category_block');
const productBlock = document.querySelector('.product_block');
const specificationBlock = document.querySelector('.specification_block');
const basketButton = document.querySelector('.basket__button');
const orderCounter = document.querySelector('.basket__order_counter')



function creatingCategoriesList () {
    categoryBlock.innerHTML = '';
    productBlock.innerHTML = '';
    categoryBlock.insertAdjacentHTML('beforeend', `<ul class="category_list"></ul>`);
    const categoryList = document.querySelector('.category_list');
    for (let el of products){
        categoryList.insertAdjacentHTML('beforeend', `<li class="category_element" id="${el.idCategory}"> ${el.category}</li>`);
    }
}

function eventCreatingProductList (event) {
    if (Array.from(event.target.classList).includes("category_element")){
        productBlock.innerHTML = '';  // обнуляем, при выборе новой категории
        specificationBlock.innerHTML = '';
        productBlock.dataset.idCategory = event.target.id; //тут сохраняю id он мне нужен дальше
        let productList = '';
        const requestedCategories = products.find(element => element.idCategory === (event.target.id)).list;
        for (let element of requestedCategories) {
            productList += `<div class='product_card' id='${element.idProduct}'>  
                <img class="product_card__img" src="${element.img}"> 
                <h2 class="product_card__title">${element.productName}</h2>  
                <p class="product_card__price"> ${element.price} грн.</p></div>`
        }
        productBlock.insertAdjacentHTML('beforeend', productList);
        return requestedCategories;
    }
}

function eventCreatingSpecificationProduct(event) {
    if (Array.from((event.target.parentNode).classList).includes("product_card")){
        specificationBlock.innerHTML = '';
        let requestedCategories = products.find(element => element.idCategory === (productBlock.dataset.idCategory)).list;
        let requestedProduct = requestedCategories.find(element => element.idProduct === ((event.target.parentElement).id));
        specificationBlock.dataset.idProduct = requestedProduct.idProduct;
        let specification = `<img class="specification_block__img" src="${requestedProduct.img}"> 
                <h2 class="specification_block__title">${requestedProduct.productName}</h2>  
                <p class="specification_block__price"> ${requestedProduct.price} грн.</p> 
                <p class="specification_block__specification"> <b>Год выпуска:</b>  ${requestedProduct.specification.year} <br> 
                <b>Цвет:</b>   ${requestedProduct.specification.color}<br>
                <b>Гарантия:</b>  ${requestedProduct.specification.guarantee} <br>
                <b>Компликтацыя:</b>   ${requestedProduct.specification.set}</p> 
                <button class="specification_block__button"> BUY </button>`;
        specificationBlock.insertAdjacentHTML('beforeend', specification);
        const byu = document.querySelector('.specification_block__button');
        byu.addEventListener('click', addOrderInBasket.bind(requestedProduct));
    }
}

function message (){
    document.body.insertAdjacentHTML('afterbegin', `<div class="message_block"> Товар Преобретен  </div>`);
    let messageBlock = document.querySelector('.message_block');
    setTimeout(()=>{messageBlock.remove();
        specificationBlock.innerHTML = "";
        productBlock.innerHTML = '';}, 1500);
}
// Генеруємо дату замовлення
function recordDate () {
    let date = new Date();
    return date.toLocaleString()
}
// перевіряємо наявність замовлень для зміни лічильники
function checkOrderInBasket () {
    if (window.localStorage.basket) {
        let localBasket = JSON.parse(window.localStorage.getItem('basket'))
        orderCounter.innerText = localBasket.length
    } else {
        orderCounter.innerText = '0'
    }
}
// фіксуємо покупку, стволюємо запис localStorage з інформацією про покупку,
// вся інфа зберігається в масиві обєктів. містить інфа необхідна для обробки саме замовлення
// функція реалізована чарез рекурсію
function addOrderInBasket (){
    let order = {
        img: this.img,
        idProduct: this.idProduct,
        productName: this.productName,
        price: this.price,
        date: recordDate(),
        delivery: 'Нова Пошта',
        deliveryAddress: 'м.Дніпро, відділення НП №73',
        payment: 'Безготівковий',
    }
    if (!window.localStorage.basket){
        window.localStorage.setItem('basket', '[]')
        addOrderInBasket.bind(this)()
    } else {
        let localBasket = JSON.parse(window.localStorage.getItem('basket'));
        localBasket.push(order);
        window.localStorage.setItem('basket', JSON.stringify(localBasket))
        checkOrderInBasket()
        message ()
    }
}

// стволює список замовлень з даних localStorage.
function eventCreatingBasketList () {
    if(!window.localStorage.basket) {
        alert('У вас немає замовлень')
    } else {
        categoryBlock.innerHTML = "";
        let localBasket = JSON.parse(window.localStorage.getItem('basket'));
        let BasketList = `<div class='basket_block'>
        <button class="basket_block__button"> Повернутися до категорій</button>
        <ol class="basket_block__list">`
        for (let element of localBasket) {
            BasketList += `
                <li class="basket_block__element" data-index-basket="${localBasket.indexOf(element)}">
                    <h3 class="basket_block__title">${element.productName}</h3>
                    <p class="basket_block__prise">${element.price} грн.</p>
                    <p class="basket_block__date">${element.date}</p>
                    <img class="basket_block__del"  src="img/free-icon-bin-5375931.png">
                </li>`
        }
        BasketList += '</ol></div>'
        categoryBlock.insertAdjacentHTML('beforeend', BasketList)
        let buttonReturnCategory = document.querySelector('.basket_block__button')
        buttonReturnCategory.addEventListener('click', creatingCategoriesList)
        let listBasket = document.querySelector('.basket_block__list')
        listBasket.addEventListener('click', eventDelOrderAndCreatingOrderInfo)
    }
}
// в данній функцію реалізовано вилалення замовлення а також розгордання информації о замовленні
// так як дві ці дії орацьовуються одним евентом вони в одній функції, хоча потрівно розділити
function eventDelOrderAndCreatingOrderInfo (event){
    if (Array.from((event.target).classList).includes("basket_block__del")) {
        let localBasket = JSON.parse(window.localStorage.getItem('basket'));
        localBasket.splice((event.target.parentNode.dataset.indexBasket), 1)
        if (localBasket.length===0) {
            window.localStorage.removeItem('basket');
            productBlock.innerHTML = '';
            creatingCategoriesList();
        } else {
            window.localStorage.setItem('basket', JSON.stringify(localBasket));
            eventCreatingBasketList()
        }
        checkOrderInBasket ()
    }
    let localBasket = JSON.parse(window.localStorage.getItem('basket'));
    let orderBasket = localBasket[event.target.parentNode.dataset.indexBasket];
    productBlock.innerHTML = '';
    let orderDetails = `<div class="order" >
            <img class="order__imq" src="img/3879794.png">
            <div class="order__body">
                <h3 class="order__title">${orderBasket.productName}</h3>
                <p class="order__date">Дата оформлення: ${orderBasket.date}</p>
                <p class="order__prise">Вартість: ${orderBasket.price} грн.</p>
                <p class="order__info">Спосіб доставки: ${orderBasket.delivery}</p>
                <p class="order__info">Адреса доставки: ${orderBasket.deliveryAddress}</p>
                <p class="order__info">Спосіб оплати: ${orderBasket.payment}</p></div></div>`
    productBlock.insertAdjacentHTML('beforeend', orderDetails)
}

creatingCategoriesList ();
categoryBlock.addEventListener('click', eventCreatingProductList);
productBlock.addEventListener('click', eventCreatingSpecificationProduct);
basketButton.addEventListener('click', eventCreatingBasketList);
checkOrderInBasket()
